<!DOCTYPE html>
<html lang="zh">
    <head><meta name="generator" content="Hexo 3.9.0">
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.3.3 -->

    <!-- Title -->
    
    <title>
        
            上传文件到七牛 | 
        
        BluedWeb
    </title>

    <!-- Meta & Info -->
    <meta charset="utf-8">

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">
    
    
    
    
    
    

    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="Blued">
    <meta name="description" content>
    <meta name="keywords" content>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.ico">
    <link rel="icon" sizes="192x192" href="/img/favicon.ico">
    <link rel="apple-touch-icon" href="/img/favicon.ico">

    <!--iOS -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="BluedWeb">

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://web.blued.cn">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="上传文件到七牛 | BluedWeb">
    <meta property="og:description" content>
    

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import CSS & jQuery -->
    
        <link rel="stylesheet" href="/css/material.min.css">
        <link rel="stylesheet" href="/css/style.min.css">
        <!-- Config CSS -->


<!-- Other Styles -->
<style>
  body, html {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", SimSun, sans-serif;;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

  #post-content pre {
    background: #272822;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->


        <script src="/js/jquery.min.js"></script>
        <script src="/js/queue.js"></script>
    

    <!-- UC Browser Compatible -->
    <script>
        var agent = navigator.userAgent.toLowerCase();
        if(agent.indexOf('ucbrowser')>0) {
            document.write("<link rel=\"stylesheet\" href=\"/css/uc.css\">");
            alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
        }
    </script>

    

    


    <!-- Bing Background -->
    

    <!-- Custom Head -->
    
<link rel="stylesheet" href="/css/prism-okaidia.css" type="text/css"></head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->

    <!-- Left aligned menu below button -->
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#服务端进行上传"><span class="post-toc-number">1.</span> <span class="post-toc-text">服务端进行上传</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#前端"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">前端</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#server-接口部分"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">server 接口部分</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#遇到的问题"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">遇到的问题</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#前端直接上传"><span class="post-toc-number">2.</span> <span class="post-toc-text">前端直接上传</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#获取上传凭证-token"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">获取上传凭证 token</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#前端上传代码"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">前端上传代码</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#遇到的问题-1"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">遇到的问题</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#编写-webpack-上传七牛的插件"><span class="post-toc-number">3.</span> <span class="post-toc-text">编写 webpack 上传七牛的插件</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#plugin-使用"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">plugin 使用</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#类的实现"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">类的实现</span></a></li></ol></li></ol>

        <!--
        <li class="mdl-menu__item">
            Some Action
        </li>
        -->
    </ul>




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
  <!-- Paradox Post Header -->
  
    
      <!-- Random Thumbnail -->
      <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50" data-original="https://user-gold-cdn.xitu.io/2019/4/18/16a2c2031196dda2?w=1168&amp;h=364&amp;f=png&amp;s=218162">
        <script>
  var randomNum = Math.floor(Math.random() * 19 + 1);

  if (!$('.post_thumbnail-random').attr('data-original')) {
    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.png');
  }
  $('.post_thumbnail-random').addClass('lazy');
</script>

      
      
        <p class="article-headline-p">
          上传文件到七牛
        </p>
      </div>
    

    


                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

  <!-- Author Avatar -->
  <div id="author-avatar">
    <img src="https://avatars3.githubusercontent.com/u/20737114?v=4" width="44px" height="44px" alt="Author Avatar"/>
  </div>
  <!-- Author Name & Date -->
  <div>
    <strong>
      <a href="https://github.com/mengxxSELF">mengxxself</a>
    </strong>
    <span>4月 19, 2019</span>
  </div>

  <div class="section-spacer"></div>

  <!-- Favorite -->
  <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

  <!-- Qrcode -->
  
    <button id="article-functions-qrcode-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
      <i class="material-icons" role="presentation">devices other</i>
      <span class="visuallyhidden">devices other</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-qrcode-button">
      <li class="mdl-menu__item">在其它设备中阅读本文章</li>
      <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPYAAAD2CAAAAADAeSUUAAAC1UlEQVR42u3ay3LbMBAEQP3/T8fXVKVkzywQiySaJ5ceJBoHj3YXrz9HXi9sbGxsbGxsbGzsS7Jf8fX359/d4d09330yWcm/z23XjI2NjX0C+4d//cHSk9eTrUlW1a4ZGxsb+xx2Hh7f36Fl53E4WzM2NjY2dh4ws0IlLzOwsbGxsXcFWB5UeQjNQhQbGxsbe9agWQ+tHHOJXho2Njb25dmzQe9n//7YfBsbGxv7YuzhQcbgp387MGhLi3rN2NjY2A9lJw9O4qEdA+cD3XbMPDx8iY2NjX1b9qyFtB4wew/6RENobGxs7Eez2wM0SZzMXm+D7fuSBhsbG/sEdh5CbVytb8p6+GFjY2Ofw14/7JiUCnnYtJEWbTo2Njb2o9mz4W6OmbX184HEUimCjY2NfXN2PtxtW/m7Im02rhiOB7CxsbFvy94LaL+7K/aGR3awsbGxH81um03tIHblzvm3sLGxsU9g7zo6kwfSyhOHRQs2Njb2Yex8DDz7/KxdNYtDbGxs7Gez8x/9bSCtNJXag5vY2NjYJ7PzW7fbkQRPTmrXUw96sbGxsW/L3rW49UZV0lRqyw9sbGzsc9h5Wz+Jq3Zbk3fbFWJjY2Ofxm7b+nlctYVKAsgHw9jY2NjnsNtRwa6mUlt45I2kpakINjY29g3ZSYC1P/2T1lI+Hm6R23IbGxsb+1bslWZQsqDZAcpZ06oIMGxsbOxHsJPYaJv4K8XMUsnRNpWwsbGxH8TOm0qzgiEvHvIw23BkBxsbG/vm7PaaHZFsA2llwIyNjY19GvsVX/mQ4HdGwnmRg42NjX0COy8bkgCbbWXy7n/spWFjY2M/gr334E6+oUk45Zs47KVhY2NjH8Zui43ZRuwa/WJjY2Njt63/9rjkLD7bcQU2Njb2Cew8EmblysrxzXxsjI2NjX0me6WV37aHiuJhOcawsbGxT2Cfc2FjY2NjY2NjY2Nf5voCSDIggjWL2h8AAAAASUVORK5CYII=">
    </ul>
  

  <!-- Tags (bookmark) -->
  
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
      <i class="material-icons" role="presentation">bookmark</i>
      <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
      <li class="mdl-menu__item">
        
    </ul>
  

  <!-- Share -->
  <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    

    <!-- Share Twitter -->
    

    <!-- Share Facebook -->
    

    <!-- Share Google+ -->
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    

    <!-- Share Telegram -->
    
</ul>

</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <a id="more"></a>
<blockquote>
<p>总结了两种上传方式</p>
</blockquote>
<h3 id="服务端进行上传"><a href="#服务端进行上传" class="headerlink" title="服务端进行上传"></a>服务端进行上传</h3><p>服务端将图片源传递到七牛，这种方式的流程是 </p>
<p>1 前端将图片传到自己的服务器<br>2 在server将文件传递到七牛</p>
<ul>
<li><a href="https://developer.qiniu.com/kodo/sdk/1289/nodejs#form-upload-file" target="_blank" rel="noopener">API</a></li>
</ul>
<h4 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h4><p>需要注意，要使用 formData 格式进行文件上传， 关于 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/FormData" target="_blank" rel="noopener">formData</a> </p>
<pre class=" language-javascript"><code class="language-javascript">document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>onchange <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> file <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

  <span class="token keyword">let</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span>

  <span class="token function">fetch</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    body<span class="token punctuation">:</span> formData<span class="token punctuation">,</span>
    credentials<span class="token punctuation">:</span> <span class="token string">'same-origin'</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// include, same-origin, *omit</span>
    method<span class="token punctuation">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// *GET, POST, PUT, DELETE, etc.</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="server-接口部分"><a href="#server-接口部分" class="headerlink" title="server 接口部分"></a>server 接口部分</h4><ul>
<li>基本参数</li>
</ul>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> bucket <span class="token operator">=</span> <span class="token string">'cancan'</span>
<span class="token keyword">const</span> accessKey <span class="token operator">=</span> <span class="token string">'2LC7KPjwnYdxxxc'</span>
<span class="token keyword">const</span> secretKey <span class="token operator">=</span> <span class="token string">'SXrxxx'</span>
<span class="token keyword">const</span> domain <span class="token operator">=</span> <span class="token string">'http://pq3xxxdn.com'</span>
</code></pre>
<ul>
<li>获取token</li>
</ul>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> get_token <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> mac <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">qiniu<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>digest<span class="token punctuation">.</span>Mac</span><span class="token punctuation">(</span>accessKey<span class="token punctuation">,</span> secretKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> policyParams <span class="token operator">=</span> <span class="token punctuation">{</span> scope<span class="token punctuation">:</span> bucket <span class="token punctuation">}</span>
  <span class="token keyword">const</span> putPolicy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">qiniu<span class="token punctuation">.</span>rs<span class="token punctuation">.</span>PutPolicy</span><span class="token punctuation">(</span>policyParams<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> uploadToken <span class="token operator">=</span> putPolicy<span class="token punctuation">.</span><span class="token function">uploadToken</span><span class="token punctuation">(</span>mac<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> uploadToken
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>拿到文件path之后进行七牛上传</li>
</ul>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">uploadFile</span><span class="token punctuation">(</span>localFile<span class="token punctuation">,</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> uploadToken <span class="token operator">=</span> <span class="token function">get_token</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">qiniu<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>Config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment" spellcheck="true">// 空间对应的机房</span>
  config<span class="token punctuation">.</span>zone <span class="token operator">=</span> qiniu<span class="token punctuation">.</span>zone<span class="token punctuation">.</span>Zone_z0<span class="token punctuation">;</span>

  <span class="token keyword">const</span> formUploader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">qiniu<span class="token punctuation">.</span>form_up<span class="token punctuation">.</span>FormUploader</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> putExtra <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">qiniu<span class="token punctuation">.</span>form_up<span class="token punctuation">.</span>PutExtra</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 文件上传</span>
    formUploader<span class="token punctuation">.</span><span class="token function">putFile</span><span class="token punctuation">(</span>uploadToken<span class="token punctuation">,</span> key<span class="token punctuation">,</span> localFile<span class="token punctuation">,</span> putExtra<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>respErr<span class="token punctuation">,</span> respBody<span class="token punctuation">,</span> respInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>respErr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>respInfo<span class="token punctuation">.</span>statusCode <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> key <span class="token punctuation">}</span> <span class="token operator">=</span> respBody
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>domain<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>接口</li>
</ul>
<pre class=" language-javascript"><code class="language-javascript">router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/upload'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// 获取到上传到服务器的文件信息</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> img <span class="token punctuation">}</span> <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>files
  <span class="token comment" spellcheck="true">// path 拿到临时文件地址</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> path <span class="token punctuation">}</span> <span class="token operator">=</span> img

  <span class="token comment" spellcheck="true">// key 是给图片的命名</span>
  <span class="token keyword">const</span> key <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">+</span> <span class="token string">'.png'</span>

  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">uploadFile</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> key<span class="token punctuation">)</span>

  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> result
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h4 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h4><ul>
<li>post 接口 始终无法解析到file参数</li>
</ul>
<p>后来发现是因为 中间件只使用了 koa-bodyparser， 一般图片上传使用的是 koa-multer，可以使用 koa-body来代替这两个</p>
<p><a href="http://www.ptbird.cn/koa-body.html" target="_blank" rel="noopener">参考文章</a></p>
<ul>
<li>临时文件占用大量磁盘空间</li>
</ul>
<p>可以看到，在将文件上传到服务器的时候，会创建一个临时文件- 接口中解析的那个 path </p>
<p><img src="https://user-gold-cdn.xitu.io/2019/4/18/16a307f8adedef5f?w=718&amp;h=29&amp;f=png&amp;s=9811" alt="path"></p>
<p>对于服务器，可以写一个定时的脚本去清除这些文件。或者我们在脚本增加一段逻辑，在成功上传到七牛之后，手动将临时文件进行删除</p>
<pre class=" language-javascript"><code class="language-javascript">fs<span class="token punctuation">.</span><span class="token function">unlink</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文件已删除'</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<ul>
<li><a href="https://github.com/mengxxSELF/qiniu-/blob/master/routes/users.js" target="_blank" rel="noopener">git地址 - server </a></li>
<li><a href="https://github.com/mengxxSELF/qiniu-/blob/master/upload.html" target="_blank" rel="noopener">git地址 - html </a></li>
</ul>
<h3 id="前端直接上传"><a href="#前端直接上传" class="headerlink" title="前端直接上传"></a>前端直接上传</h3><p>项目中的例子涉及到的图片上传，都是将文件上传到服务器然后再去传到七牛空间，这种操作方式，相当于在自己的服务器做了一层中转站。开发者可以在中转站对图片做一些处理然后在传到七牛空间。但是有一些缺点</p>
<ul>
<li><p>内存占用量增大</p>
</li>
<li><p>临时文件占用磁盘空间，需要每次上传之后需要进行文件删除</p>
</li>
</ul>
<p>如果开发中不需要中转站，可以考虑直接从前端将图片上传到七牛空间</p>
<p>参考七牛的API文档，基本可以涉及到的是</p>
<ul>
<li><p><a href="https://developer.qiniu.com/kodo/sdk/1289/nodejs#simple-uptoken" target="_blank" rel="noopener">上传凭证的生成</a></p>
</li>
<li><p><a href="https://developer.qiniu.com/kodo/sdk/1283/javascript" target="_blank" rel="noopener">前端文件上传</a></p>
</li>
<li><p><a href="https://developer.qiniu.com/kodo/manual/1671/region-endpoint" target="_blank" rel="noopener">区域</a></p>
</li>
<li><p><a href="https://developer.qiniu.com/kodo/manual/1206/put-policy" target="_blank" rel="noopener">上传策略参数设置</a></p>
</li>
</ul>
<h4 id="获取上传凭证-token"><a href="#获取上传凭证-token" class="headerlink" title="获取上传凭证 token"></a>获取上传凭证 token</h4><pre class=" language-javascript"><code class="language-javascript">router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/qiniu'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> bucket <span class="token operator">=</span> <span class="token string">'activity'</span>
  <span class="token keyword">const</span> accessKey <span class="token operator">=</span> <span class="token string">'2LCxxxrxxx'</span>
  <span class="token keyword">const</span> secretKey <span class="token operator">=</span> <span class="token string">'SXrdqdvxxx'</span>

  <span class="token keyword">const</span> mac <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">qiniu<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>digest<span class="token punctuation">.</span>Mac</span><span class="token punctuation">(</span>accessKey<span class="token punctuation">,</span> secretKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> policyParams <span class="token operator">=</span> <span class="token punctuation">{</span> scope<span class="token punctuation">:</span> bucket <span class="token punctuation">}</span>
  <span class="token keyword">const</span> putPolicy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">qiniu<span class="token punctuation">.</span>rs<span class="token punctuation">.</span>PutPolicy</span><span class="token punctuation">(</span>policyParams<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> uploadToken <span class="token operator">=</span> putPolicy<span class="token punctuation">.</span><span class="token function">uploadToken</span><span class="token punctuation">(</span>mac<span class="token punctuation">)</span><span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> uploadToken
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h4 id="前端上传代码"><a href="#前端上传代码" class="headerlink" title="前端上传代码"></a>前端上传代码</h4><ul>
<li>base64转 blob</li>
</ul>
<pre class=" language-javascript"><code class="language-javascript">    <span class="token keyword">function</span> <span class="token function">base64ToBlob</span><span class="token punctuation">(</span>dataurl<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
      <span class="token keyword">var</span> arr <span class="token operator">=</span> dataurl<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
      mime <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/:(.*?);/</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
      bstr <span class="token operator">=</span> <span class="token function">atob</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
      n <span class="token operator">=</span> bstr<span class="token punctuation">.</span>length<span class="token punctuation">,</span> 
      u8arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">while</span> <span class="token punctuation">(</span>n<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
        u8arr<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> bstr<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token punctuation">}</span> 
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>u8arr<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> mime <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
</code></pre>
<ul>
<li>基本参数</li>
</ul>
<pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// 这个token 就是 server接口返回的token</span>
<span class="token keyword">const</span> token <span class="token operator">=</span> <span class="token string">'2LC7KTxxx'</span>

<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
  useCdnDomain<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  region<span class="token punctuation">:</span> qiniu<span class="token punctuation">.</span>region<span class="token punctuation">.</span>z1
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> putExtra <span class="token operator">=</span> <span class="token punctuation">{</span>
  fname<span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  params<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  mimeType<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre>
<ul>
<li>核心上传</li>
</ul>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> inputTarget <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span>
inputTarget<span class="token punctuation">.</span>onchange <span class="token operator">=</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> imgfile <span class="token operator">=</span> inputTarget<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

    <span class="token keyword">const</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    reader<span class="token punctuation">.</span><span class="token function">readAsDataURL</span><span class="token punctuation">(</span>imgfile<span class="token punctuation">)</span><span class="token punctuation">;</span>
    reader<span class="token punctuation">.</span>onload <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> urlData <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>result<span class="token punctuation">;</span>
      <span class="token keyword">const</span> blobData <span class="token operator">=</span> <span class="token function">base64ToBlob</span><span class="token punctuation">(</span>urlData<span class="token punctuation">)</span>

      <span class="token comment" spellcheck="true">// 这里第一个参数的形式是blob</span>
      <span class="token keyword">const</span> observable <span class="token operator">=</span> qiniu<span class="token punctuation">.</span><span class="token function">upload</span><span class="token punctuation">(</span>blobData<span class="token punctuation">,</span> <span class="token string">'filename.png'</span><span class="token punctuation">,</span> token<span class="token punctuation">,</span> putExtra<span class="token punctuation">,</span> config<span class="token punctuation">)</span>

      <span class="token keyword">const</span> observer <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token function">next</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">complete</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
       <span class="token comment" spellcheck="true">// 注册observer 对象</span>
      observable<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<p><img src="https://user-gold-cdn.xitu.io/2019/4/18/16a2c16b3f762c32?w=1446&amp;h=174&amp;f=png&amp;s=50909" alt="result"></p>
<p>文件就可以被传到七牛了</p>
<p>可以看到这里返回的是一个hash和key，图片最后完整的访问路径，是你的七牛上配置的域名+key</p>
<p>在七牛创建一个新空间的话，会提供一个30天的免费域名可以使用</p>
<ul>
<li><p><a href="https://github.com/mengxxSELF/qiniu-/blob/master/routes/users.js" target="_blank" rel="noopener">git地址 - server </a></p>
</li>
<li><p><a href="https://github.com/mengxxSELF/qiniu-/blob/master/index.html" target="_blank" rel="noopener">git地址 - html </a></p>
</li>
</ul>
<h4 id="遇到的问题-1"><a href="#遇到的问题-1" class="headerlink" title="遇到的问题"></a>遇到的问题</h4><ul>
<li>cdnUphost 解析失败</li>
</ul>
<p><img src="https://user-gold-cdn.xitu.io/2019/4/18/16a2c18b6ee09296?w=1194&amp;h=280&amp;f=png&amp;s=77757" alt></p>
<p><img src="https://user-gold-cdn.xitu.io/2019/4/18/16a2c18deaf558fc?w=1172&amp;h=158&amp;f=png&amp;s=58091" alt></p>
<p>原来是把</p>
<pre class=" language-javascript"><code class="language-javascript"> <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
    useCdnDomain<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    region<span class="token punctuation">:</span> <span class="token string">'qiniu.region.z0'</span>
 <span class="token punctuation">}</span>
</code></pre>
<p>这里的region 写错了，不应是字符串，就是一个七牛的变量</p>
<pre class=" language-javascript"><code class="language-javascript"> <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
    useCdnDomain<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    region<span class="token punctuation">:</span> qiniu<span class="token punctuation">.</span>region<span class="token punctuation">.</span>z0
 <span class="token punctuation">}</span>
</code></pre>
<p>这个参数是取决于你的空间存储区域选择的是哪里</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/4/18/16a2c4a9d9d480f4?w=1694&amp;h=284&amp;f=png&amp;s=64360" alt></p>
<p>对照文档 <a href="https://developer.qiniu.com/kodo/manual/1671/region-endpoint" target="_blank" rel="noopener">区域</a>  进行z0 z1的选择</p>
<ul>
<li>图片上传之后却无法读取，显示已损坏</li>
</ul>
<p>是因为第一次的时候，直接将 input的files[0] 值上传, 这里与文档要求的参数格式不一致 文档里对这个参数的要求是blob，所以记得这里需要转化一下文件格式</p>
<p>以前的demo写的一直失败就搁置了，今天重新跑了一次，再次吐槽七牛的文档，写的真是让人头大</p>
<h3 id="编写-webpack-上传七牛的插件"><a href="#编写-webpack-上传七牛的插件" class="headerlink" title="编写 webpack 上传七牛的插件"></a>编写 webpack 上传七牛的插件</h3><p>在开发中，有使用一个webpack的配置， <a href="https://www.npmjs.com/package/qiniu-webpack-plugin" target="_blank" rel="noopener">qiniu-webpack-plugin</a></p>
<p>参照这个的使用方式，另外写一个上传plugin</p>
<p>涉及到的一些文档</p>
<ul>
<li><p><a href="https://www.webpackjs.com/concepts/plugins/" target="_blank" rel="noopener">webpack plugin API</a></p>
</li>
<li><p><a href="https://www.webpackjs.com/api/compiler-hooks/" target="_blank" rel="noopener">webpack plugin config</a></p>
</li>
</ul>
<h4 id="plugin-使用"><a href="#plugin-使用" class="headerlink" title="plugin 使用"></a>plugin 使用</h4><pre class=" language-javascript"><code class="language-javascript">    <span class="token comment" spellcheck="true">// 这个是编译文件编译到的文件夹</span>
    <span class="token keyword">const</span> filePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'public'</span><span class="token punctuation">)</span>

    <span class="token keyword">new</span> <span class="token class-name">QiuniuUploadPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      bucket<span class="token punctuation">,</span>
      accessKey<span class="token punctuation">,</span>
      secretKey<span class="token punctuation">,</span>
      domain<span class="token punctuation">,</span>
      path<span class="token punctuation">:</span> filePath
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h4 id="类的实现"><a href="#类的实现" class="headerlink" title="类的实现"></a>类的实现</h4><p>这个的逻辑大部分和从后端直接上传到七牛有重合，这里只把另一部分写出来</p>
<ul>
<li>大致实现</li>
</ul>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">QiuniuUploadPlugin</span> <span class="token punctuation">{</span>
  constructor <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>

  uploadQn <span class="token punctuation">(</span>filename<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>

  apply <span class="token punctuation">(</span>compiler<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> pluginName <span class="token operator">=</span> <span class="token string">'QiuniuUploadPlugin'</span>
    <span class="token comment" spellcheck="true">// 事件钩子</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>run<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span>pluginName<span class="token punctuation">,</span> compilation <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"webpack 构建过程开始！"</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// afterEmit - 生成资源到 output 目录之后将触发  异步钩子 - tapPromise</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>afterEmit<span class="token punctuation">.</span><span class="token function">tapPromise</span><span class="token punctuation">(</span>pluginName<span class="token punctuation">,</span> <span class="token punctuation">(</span>compilation<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> <span class="token punctuation">{</span> assets <span class="token punctuation">}</span> <span class="token operator">=</span> compilation
      <span class="token comment" spellcheck="true">// assets 这里拿到的assets是一个对象 key是文件名 value是相关关参数 我们只需要key</span>
      <span class="token comment" spellcheck="true">// assets -->>>  { 'index.js' : xxxx }</span>

      <span class="token comment" spellcheck="true">// 遍历所有的文件名 进行七牛的上传</span>
      <span class="token keyword">const</span> allUplaod <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>assets<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">uplaodQn</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>

      <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>allUplaod<span class="token punctuation">)</span>

    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
<ul>
<li><p><a href="https://github.com/mengxxSELF/qiniu-/blob/master/webpack.config.js" target="_blank" rel="noopener">git - webpack</a></p>
</li>
<li><p><a href="https://github.com/mengxxSELF/qiniu-/blob/master/qiniu-webpack-plugin.js" target="_blank" rel="noopener">git - plugin具体实现</a></p>
</li>
</ul>

    

    
</div>


                

                <!-- Post Comments -->
                
                    




    <!-- 使用 DISQUS -->
    <div id="disqus-comment">
        <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
        this.page.url = 'http://web.blued.cn/2019/04/19/上传文件到七牛/';  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = 'http://web.blued.cn/2019/04/19/上传文件到七牛/'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    queue.offer(function() {
            (function() { // DON'T EDIT BELOW THIS LINE
                var d = document;
                var s = d.createElement('script');
                s.src = '//bluedweb.disqus.com/embed.js';
                s.setAttribute('data-timestamp', + new Date());
                (d.head || d.body).appendChild(s);
            })();
        });
</script>

    </div>
    <style>
        #disqus-comment{
            background-color: #eee;
            padding: 2pc;
        }
    </style>




                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2019/08/07/分分钟搞定node爬虫/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2019/01/23/how-to-run-qconf-on-osx/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
  <!-- Top bar -->
  <div class="top-bar"></div>

  <!-- Sidebar toggle button -->
  <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
    <i class="material-icons">clear_all</i>
    <span class="mdl-button__ripple-container">
      <span class="mdl-ripple"></span>
    </span>
  </button>

  <!-- Sidebar Avatar -->
  <div class="sidebar-image">
    <img src="/img/avatar.png" alt="Blued's avatar">
  </div>

  <!-- Sidebar Email -->
  <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
    web@blued.com
    <b class="caret"></b>
  </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="mailto:web@blued.com" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
                <li>
                    <a href="https://github.com/bluedapp" target="_blank" title="GitHub">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">home</i>
                        
                        GitHub
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/" target="_self">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2019/10/">十月 2019<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/08/">八月 2019<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/04/">四月 2019<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/01/">一月 2019<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/09/">九月 2018<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/05/">五月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/04/">四月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/03/">三月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/12/">十二月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/10/">十月 2017<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/09/">九月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/08/">八月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/07/">七月 2017<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/06/">六月 2017<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/05/">五月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/04/">四月 2017<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    

    <!-- Pages  -->
    

    <!-- Article Number  -->
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->

    <a href="https://github.com/viosey/hexo-theme-material"  class="sidebar-footer-text-a" target="_blank">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
            主题 - Material
            <span class="sidebar-badge badge-circle">i</span>
        </div>
    </a>


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
        <a href="https://twitter.com/blued" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-twitter.svg);">
                <span class="visuallyhidden">Twitter</span>
            </button><!--
     --></a>
    

    <!-- Facebook -->
    
        <a href="https://www.facebook.com/bluedapp" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-facebook.svg);">
                <span class="visuallyhidden">Facebook</span>
            </button><!--
     --></a>
    

    <!-- Google + -->
    

    <!-- Weibo -->
    
        <a href="http://weibo.com/bluedapp" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-weibo.svg);">
                <span class="visuallyhidden">Weibo</span>
            </button><!--
     --></a>
    

    <!-- Instagram -->
    
        <a href="https://instagram.com/bluedapp" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-instagram.svg);">
                <span class="visuallyhidden">Instagram</span>
            </button><!--
     --></a>
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="https://github.com/bluedapp" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-github.svg);">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;
            <script type="text/javascript">
                var fd = new Date();
                document.write(fd.getFullYear());
            </script>
            &nbsp;BluedWeb
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import File -->

    <script src="/js/lazyload.min.js"></script>
    <script src="/js/js.min.js"></script>



    <script src="/js/nprogress.js"></script>


<script type="text/javascript">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>












    <!-- 使用 DISQUS js 代码 -->
    <script id="dsq-count-scr" src="//bluedweb.disqus.com/count.js" async></script>





<!-- Window Load-->
<script>
    $(window).load(function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });
</script>

<!-- MathJax Load-->

<script>
    <!-- Offer LazyLoad -->
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    <!-- Start Queue -->
    $(document).ready(function(){
        setTimeout(function(){
            setInterval(function(){
                queue.execNext();
            },200);
        },3000);
    });
</script>

                </main>
            </div>
        </body>
    
</html>
