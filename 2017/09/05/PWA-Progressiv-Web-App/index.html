<!DOCTYPE html>
<html lang="zh">
    <head><meta name="generator" content="Hexo 3.9.0">
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.3.3 -->

    <!-- Title -->
    
    <title>
        
            PWA(Progressiv Web App) | 
        
        BluedWeb
    </title>

    <!-- Meta & Info -->
    <meta charset="utf-8">

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">
    
    
    
    
    
    

    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="Blued">
    <meta name="description" content>
    <meta name="keywords" content=",Chrome">

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.ico">
    <link rel="icon" sizes="192x192" href="/img/favicon.ico">
    <link rel="apple-touch-icon" href="/img/favicon.ico">

    <!--iOS -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="BluedWeb">

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://web.blued.cn">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="PWA(Progressiv Web App) | BluedWeb">
    <meta property="og:description" content>
    <meta property="og:article:tag" content="Chrome"> 

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import CSS & jQuery -->
    
        <link rel="stylesheet" href="/css/material.min.css">
        <link rel="stylesheet" href="/css/style.min.css">
        <!-- Config CSS -->


<!-- Other Styles -->
<style>
  body, html {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", SimSun, sans-serif;;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

  #post-content pre {
    background: #272822;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->


        <script src="/js/jquery.min.js"></script>
        <script src="/js/queue.js"></script>
    

    <!-- UC Browser Compatible -->
    <script>
        var agent = navigator.userAgent.toLowerCase();
        if(agent.indexOf('ucbrowser')>0) {
            document.write("<link rel=\"stylesheet\" href=\"/css/uc.css\">");
            alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
        }
    </script>

    

    


    <!-- Bing Background -->
    

    <!-- Custom Head -->
    
<link rel="stylesheet" href="/css/prism-okaidia.css" type="text/css"></head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->

    <!-- Left aligned menu below button -->
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        

        <!--
        <li class="mdl-menu__item">
            Some Action
        </li>
        -->
    </ul>




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
  <!-- Paradox Post Header -->
  
    
      <!-- Random Thumbnail -->
      <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50" data-original="/img/osen/20170905_pwa/banner.png">
        <script>
  var randomNum = Math.floor(Math.random() * 19 + 1);

  if (!$('.post_thumbnail-random').attr('data-original')) {
    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.png');
  }
  $('.post_thumbnail-random').addClass('lazy');
</script>

      
      
        <p class="article-headline-p">
          PWA(Progressiv Web App)
        </p>
      </div>
    

    


                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

  <!-- Author Avatar -->
  <div id="author-avatar">
    <img src="https://avatars2.githubusercontent.com/u/239320?v=4" width="44px" height="44px" alt="Author Avatar"/>
  </div>
  <!-- Author Name & Date -->
  <div>
    <strong>
      <a href="https://github.com/wanghaiyang">osen</a>
    </strong>
    <span>9月 05, 2017</span>
  </div>

  <div class="section-spacer"></div>

  <!-- Favorite -->
  <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

  <!-- Qrcode -->
  
    <button id="article-functions-qrcode-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
      <i class="material-icons" role="presentation">devices other</i>
      <span class="visuallyhidden">devices other</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-qrcode-button">
      <li class="mdl-menu__item">在其它设备中阅读本文章</li>
      <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPYAAAD2CAAAAADAeSUUAAAC2UlEQVR42u3ay05DMQwFwP7/T5ctEig9toNok8mquqXFEyQsPx7PK88DGxsbGxsbGxsb+y3Zj/j8/PnvT9bfmb/78zvXMSQxY2NjY9/AfvGvfxlcElYPsL6IaszY2NjYN7DX4a7ZSRBrTO9JHjM2NjY2dl5I5GmmCsPGxsbG3sVOXlfLjGpJg42NjY3da9D0GkO9ltD8G7CxsbHvYVcHve/w+h/m29jY2Nhvya6efNVmstDTa069iBwbGxv7UHZ1/XFShPTGw3m63VCBYWNjY38se7KCmb9bXaysjhZe/CGxsbGxD2Xn7fgkLeUjhGp7KL+sQgWGjY2NfQQ7TxjVtcveqabGPDZsbGzsU9m9AqCX2HqkaklTGPRiY2NjH8pOxgbrwiN5vitlbmgqYWNjYx/B3tWmr4ZSHeL2Ei02Njb2DewkLSVJK7+IfNi8jqFQ9mBjY2NfwM4TSfKpnJenut6AARsbG/ts9l8MWZM0k19QdSRQmG9jY2NjH8fuJZhe0TJPjaNSBBsbG/sgdt646Q0GkrFx74rzkTM2Njb22ezeOuM8peXtpHnqwsbGxr6BnQxre+2kwnLkYPnyGRxsbGzss9nbFhz/YHUyv9bRoBcbGxv7Y9nzZlA1wfQSW/Xifvm92NjY2Eez5wVG3gCaDAySogUbGxv7NnYvFVVb/KNwW0s/hV4aNjY29oezq+2barHRS12TZVBsbGzsm9nVBtOutn41UeWjYmxsbOwb2Hl5UA00x+SDhOogGRsbG/sGdvX0FnfyMe18DNzM29jY2Ngfy96bJPLWT/VJcn3lqQg2Njb2QewkaVUDyguPXgx5ssTGxsa+hz1PWvPBQ87b0EvDxsbGvpKdB5GPH/I0WY0QGxsbGzv/0kkzqHfycgUbGxv7Hna1oTNpKuVpKflUc9CLjY2NfRB7MujN1zero4V8cWcdDzY2NvbZ7HsONjY2NjY2NjY29tucL6jechQ0eaKcAAAAAElFTkSuQmCC">
    </ul>
  

  <!-- Tags (bookmark) -->
  
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
      <i class="material-icons" role="presentation">bookmark</i>
      <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
      <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/Chrome/">Chrome</a>
    </ul>
  

  <!-- Share -->
  <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    

    <!-- Share Twitter -->
    

    <!-- Share Facebook -->
    

    <!-- Share Google+ -->
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    

    <!-- Share Telegram -->
    
</ul>

</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <p>【 PWA 】</p>
<blockquote>
<p>今天开始 Research 一个新的前端技术，PWA（ 全称：Progressive Web App ）也就是说这是个渐进式的网页应用程序。这个技术的呢是 Google 公司于2015 年提出的，2016 年 6 月才推广的项目。针对这一项技术目前在国外似乎已经很流行了，目前应用这项技术最火热的应用是在印度（ 大家或许会疑惑为什么是在印度最流行呢吧，下文中会告诉大家哦 ），既然 PWA 这项技术在国外已经非常的流行了，那么在国内或许会不远了（ Angular 5 中新增的功能中，重点在于能够更轻松的构建渐进式网络应用程序，也就是 PWA 了。作为Google 和 mozilla 的产物，肯定会越来越重视啦 ）我引用一下关于PWA技术的一篇最早的博客文中的一句话吧： “ escaping tabs without losing our soul “（ 翻译一下哈：逃避选项卡而不丢失我们的灵魂 ）。</p>
</blockquote>
<p>官网上给出 PWA 的宣传是 ： <code>Reliable</code> （ 可靠的 ）、<code>Fast</code>（ 快速的 ）、<code>Engaging</code>（ 可参与的 ）（ 官网：<a href="https://developers.google.com/web/progressive-web-apps/" target="_blank" rel="noopener">https://developers.google.com/web/progressive-web-apps/</a>     ps：需要翻墙哦  ）。简单的说一下这三个特性：</p>
<p> <code>Reliable</code> ： 为什么他是可靠的呢，当用户从手机主屏幕启动时，不用考虑网络的状态是如何，都可以立刻加载出 PWA。</p>
<p> <img src="/img/osen/20170905_pwa/1.png" alt></p>
<p> <code>Fast</code>：这一点应该都很熟悉了吧，站在用户的角度来考虑，如果一个网页加载速度有点长的话，那么我们会放弃浏览该网站，所以 PWA 在这一点上做的很好，他的加载速度是很快的。</p>
<p> <img src="/img/osen/20170905_pwa/2.png" alt></p>
<p> <code>Engaging</code> ： PWA 可以添加在用户的主屏幕上，不用从应用商店进行下载（ 似乎省了下载流量哦！）他们通过网络应用程序 <code>Manifest file</code> 提供类似于 APP 的使用体验（ 在 Android 上可以设置全屏显示哦，由于 Safari 支持度的问题，所以在 IOS 上并不可以 ），并且还能进行 ”推送通知” 。</p>
<p> <img src="/img/osen/20170905_pwa/3.png" alt></p>
<p> 这三个主特性似乎能解释我在前言中所说的 ”在印度最流行“ 。小小的普及一下，根据2016年第三季度的 IDC统计数据显示，印度的智能手机的出货量达到了3亿，同时也超过了美国，成为了全球第二大智能手机市场。皮尤斯数据报告 2015 年曾统计过“全球智能手机拥有率”。印度只有 17% 的人口用的是智能手机。虽然绝大部分人有手机用，但为非智能机，另有 22% 的人没有手机。针对印度的移动网络流量来说，网络状况是非常不佳的，根据16年的 GSMA 印度移动经济报告显示，网络覆盖率为34.8% 。主要集中在城镇，印度广大的农村还处于网络盲区，城乡数字化鸿沟很大。在印度，2G/3G 最主流，且 2G 占比还远高于 3G ， 所以针对这种状态来说，PWA 技术最适合不过了。</p>
<p> 在我对 PWA 技术的研究中发现 PWA 其中有三个关键的技术：</p>
<ul>
<li><code>Service Worker</code>（ ps：就叫做服务工厂吧，文章最后一条 URL 是 SW 的全面进阶，可以研究研究哦 ）</li>
<li><code>Manifest</code> （应用清单）</li>
<li><code>Push Notification</code>（推送通知）</li>
</ul>
<blockquote>
<p>下面我一一介绍着三个关键的技术：</p>
</blockquote>
<p><code>Service Worker</code>（ 以下用SW来代替 ） ：</p>
<p>SW 是什么呢？这个是离线缓存文件。我们 PWA 技术使用的就是它！SW 是浏览器在后台独立于网页运行的脚本，它打开了通向不需要网页或用户交互的功能的大门，因为使用了它，才会有的那个 <code>Reliable</code> 特性吧，SW 作用于 浏览器于服务器之间，相当于一个代理服务器（ 用一张图来表示一下他的位置 ）。  </p>
<p><img src="/img/osen/20170905_pwa/4.png" alt></p>
<p>为什么会用到 SW 呢？原声 App 拥有Web应用通常所不具备的富离线体验，定时默认更新，消息推送等功能，而 SW 标准让在 Web App 上拥有这些功能成为可能！</p>
<p>跟 SW 相同的 API 还有 <code>App Cache</code> ，为什么不使用它呢？ <code>App Cache</code> 是有局限性的，比如说：它很容易得解决 <code>single web page application</code> （ 单页面应用 ）的问题，但是在多页面应用上会很麻烦， SW 解决的这个 <code>App Cache</code>的缺点！</p>
<p> 下面我简单而详细的说一下 SW ：<br> 1、 浏览器支持</p>
<blockquote>
<p>顺便带一句：目前只能在 HTTPS 环境下才能使用SW，因为SW 的权利比较大，能够直接截取和返回用户的请求，所以要考虑一下安全性问题。</p>
</blockquote>
<p><img src="/img/osen/20170905_pwa/5.png" alt></p>
<p>2、事件机制</p>
<p><img src="/img/osen/20170905_pwa/6.png" alt></p>
<p>3、 功能</p>
<blockquote>
<p>SW的功能还是比较逆天的！</p>
</blockquote>
<ul>
<li>后台数据的同步</li>
<li>从其他域获取资源请求</li>
<li>接受计算密集型数据的更新，多页面共享该数据</li>
<li>客户端编译与依赖管理</li>
<li>后端服务的hook机制</li>
<li>根据URL模式，自定义模板</li>
<li>性能优化</li>
<li>消息推送</li>
<li>定时默认更新</li>
<li>地理围栏</li>
</ul>
<p>4、 生命周期</p>
<p><img src="/img/osen/20170905_pwa/7.png" alt></p>
<p><code>Parsed</code> （ 解析成功 ）： 首次注册 SW 时，浏览器解决脚本并获得入口点，如果解析成功，就可以访问到 SW 注册对象，在这一点中我们需要在 HTML 页面中添加一个判断，判断该浏览器是否支持 SW 。</p>
<p><code>Installing</code> （ 正在安装 ）：SW 脚本解析完成之后，浏览器会尝试进行安装，<code>installing</code> 中 <code>install</code> 事件被执行，如果其中有 <code>event.waitUntil ( )</code>方法，则 <code>installing</code> 事件会一直等到该方法中的 <code>Promise</code> 完成之后才会成功，如果 <code>Promise</code> 被拒绝，则安装失败，SW会进入 <code>Redundant</code>（ 废弃 ）状态。</p>
<p><code>Installed / Waiting</code> （安装成功/等待中）：如果安装成功，SW 将会进入这个状态。</p>
<p><code>Activating</code> （ 正在激活 ）：处于 waiting 状态的 SW 发生以下情况，将会进入 activating 状态中：</p>
<p>当前已无激活状态的 <code>worker</code> 、 SW脚本中的 <code>self.skipWaiting（）</code>方法被调用 （ <em>ps： self 是 SW 中作用于全局的对象，这个方法根据英文翻译过来也能明白什么意思啦，跳过等待状态</em> ）、用户已关闭 SW 作用域下的所有页面，从而释放了当前处于激活状态的 <code>worker</code>、超出指定时间，从而释放当前处于激活状态的 <code>worker</code></p>
<p><code>Activated</code> （ 激活成功 ）：该状态，其成功接收了 <code>document</code> 全面控制的激活态 <code>worker</code> 。</p>
<p><code>Redundant</code> （ 废弃 ）：这个状态的出现时有原因的，如果 <code>installing</code> 事件失败或者 <code>activating</code> 事件失败或者新的 SW 替换其成为激活态 <code>worker</code> 。<code>installing</code> 事件失败和 <code>activating</code> 事件失败的信息我们可以在 <code>Chrome</code> 浏览器的 <code>DevTools</code> 中查看：</p>
<p>（ <em>ps：我这个是正常的状态下的 ，错误的话会有 error 提示的</em> ）</p>
<p><img src="/img/osen/20170905_pwa/8.png" alt></p>
<p>5、主要依赖</p>
<p>SW 作为现代浏览器的高级特性，依赖于 <code>fetch</code> 、<code>promise</code> 、<code>CacheStorage</code>、<code>Cache</code>、等浏览器的基础能力， <code>Cache</code> 提供了 <code>Request</code> / <code>Response</code> 对象对的存储机制。<code>CacheStorage</code> 则提供了存储 <code>Cache</code> 对象的机制。      </p>
<p><img src="/img/osen/20170905_pwa/9.png" alt></p>
<p>6、安全性问题</p>
<p>跨域请求支持：  SW 可以拦截它作用域内的所有请求，跨域资源也不例外，但是浏览器默认对跨域资源发起的是 <code>no-cors</code> 请求，得到的 <code>response</code> 是 <code>opaque</code> 的， 所以会导致我们无法判断跨域请求是否成功，以便进行缓存，因此我们需要修改 <code>fetch</code> 请求头部信息，添加 <code>mode：’cors’</code> 标记。</p>
<p>（ 名词解释一下喽，这部分知识是关于 <code>fetch API</code> 的，想了解更多的同学，自行搜索相关的知识哈 ）</p>
<p><code>no-cors</code>：该模式允许来自 CDN 的脚本、其他域的图片和其他一些跨域资源，但是首先有个前提条件，就是请求的 <code>method</code> 只能是 <code>HEAD</code> 、<code>GET</code> 、<code>POST</code> 。此外，如果 <code>ServiceWorkers</code> 拦截了这些请求，它不能随意添加或者修改除这些之外 <code>Header</code> 属性。第三，JS 不能访问 <code>Response</code> 对象中的任何属性，这确保了跨域时 <code>ServiceWorkers</code> 的安全和隐私信息泄漏问题。</p>
<p><code>opaque</code>：<code>Response</code> 对象中 <code>type</code> 属性的值 ， 在 <code>no-cors</code> 模式下请求了跨域资源，依靠服务端来做限制。</p>
<blockquote>
<p>Manifest （ 应用清单 ）</p>
</blockquote>
<p>Web App Manifest 是一个 W3C 规范，它定义了一个基于 JSON 的 List 。Manifest 在 PWA 中的作用有：</p>
<ul>
<li>能够将你浏览的网页添加到你的手机屏幕上</li>
<li>在 Android 上能够全屏启动，不显示地址栏 （ 由于 Iphone 手机的浏览器是 Safari ，所以不支持哦）</li>
<li>控制屏幕 横屏 / 竖屏 展示</li>
<li>定义启动画面</li>
<li>可以设置你的应用启动是从主屏幕启动还是从 URL 启动</li>
<li>可以设置你添加屏幕上的应用程序图标、名字、图标大小</li>
<li>Push Notification （ 消息通知 ）</li>
<li>Push 和 Notification 是两个不同的功能，涉及到两个 API 。</li>
<li>Notification 是浏览器发出的通知消息。</li>
<li>Push 和 Notification 的关系，Push：服务器端将更新的信息传递给 SW ，Notification： SW 将更新的信息推送给用户。</li>
</ul>
<p>缺点：</p>
<ul>
<li>浏览器的支持度问题，尤其是 Safari 浏览器，这样就会导致我们在 IOS 系统手机上没办法体验 PWA 。（ 谁让 ‘ 果果 ’ 不是开源的呢 ）</li>
<li>根据国情来看哈，目前 Native App 的使用用户都已经习惯了，虽然会下载一下，但是现在 WiFi 到处都是了，毕竟 WiFi 的普及太快了。让用户使用 PWA 来替代 Native App 短时间会不适应的。</li>
<li>消息推送问题，PWA的消息推送走的是 GCM（ FCM ）通道。而国内 Google 是无法访问的。（只能翻墙了，但是工信部已经禁止使用 VPN 了。）</li>
</ul>
<p>总体来说：</p>
<p>Google 的技术在国内推进比较缓慢，所以 PWA 在国内的发展是有多困难吧。</p>
<p>【 Demo 】<br>首先呢，我们用到有 Node 和 Ngrok 。Node 的使用以及安装我就不说啦，作为一名前端开发工程师肯定会使用的啦。不会使用也米有关系啦，我们有度娘呢，Ngrok 的安装以及使用我就直接共享一个URl吧：<a href="http://blog.csdn.net/tomcat_2014/article/details/68944066（" target="_blank" rel="noopener">http://blog.csdn.net/tomcat_2014/article/details/68944066（</a> <em>ps：我就偷懒一下</em> ）</p>
<ul>
<li>我们先创建一个关于 PWA 的项目文件夹，</li>
<li>进入文件夹下我们准备一张 120x120的图片一张，作为我们的应用程序图标。</li>
<li>创建一个 index.html  文件</li>
<li>创建一个 index.css 文件</li>
<li>创建一个 manifest.json 文件</li>
<li>创建一个 sw.js 文件</li>
<li>利用终端，安装一下 http-server 服务</li>
<li>下面我们看一下每个文件中的代码是什么吧：</li>
</ul>
<p>index.html</p>
<p><img src="/img/osen/20170905_pwa/10.png" alt></p>
<p>index.css</p>
<p><img src="/img/osen/20170905_pwa/11.png" alt></p>
<p>manifest.json</p>
<blockquote>
<p>一些参数的简单的介绍</p>
</blockquote>
<p>short_name: “ “ 用户主屏幕上的应用名字</p>
<p>display : “standalone”  设置启动样式，让您的网络应用隐藏浏览器的 URL 地址栏</p>
<p>start_url : “/“ 设置启动网址，如果不提供的话，默认是使用当前页面</p>
<p>theme_color : “ “  用来告知浏览器用什么颜色来为地址栏等 UI 元素着色</p>
<p>background_color: “ ” 设置启动页面的背景颜色</p>
<p>icons：””  就是添加到主屏幕之后的图标</p>
<p><img src="/img/osen/20170905_pwa/12.png" alt></p>
<p>sw.js</p>
<p>处理静态缓存，首先定义需要缓存的路径，以及需要缓存的静态文件的列表。</p>
<p>借助 SW 注册完成安装 SW 时，抓取资源写入缓存中。使用了一个方法那就是 <code>self.skipWaiting( )</code> 这个方法我在前边介绍的时候也说了，为了在页面更新的过程当中，新的 SW 脚本能够立刻激活和生效。</p>
<p><img src="/img/osen/20170905_pwa/13.png" alt></p>
<p>处理动态缓存，我们监听 <code>fetch 事件</code>，在 <code>caches</code> 中去 <code>match</code> 事件的 <code>request</code> ，如果 <code>response</code> 不为空的话就返回 <code>response</code> ，最后返回 <code>fetch</code> 请求，在 <code>fetch</code> 事件中我们可以手动生成 <code>response</code> 返回给页面。</p>
<p>更新静态资源，缓存的资源会跟随着版本的更新会过期的，所以会根据缓存的字符串名称清除旧缓存。在新安装的 SW 中通过调用 <code>self.clients.claim( )</code> 取得页面的控制权，这样之后打开页面都会使用版本更新的缓存。旧的 SW 脚本不在控制着页面之后会被停止，也就是会进入 <code>Redundant</code> 期。</p>
<p><img src="/img/osen/20170905_pwa/14.png" alt></p>
<p>以上截图中最左侧是我文件下的列表喽，下面我们来运行一下，终端启动 <code>http-server</code> 服务，我们以关闭缓存的方式进行启动。</p>
<p><img src="/img/osen/20170905_pwa/15.png" alt></p>
<p>接下来我们使用 ngrok 这个工具，进行内网穿透。在上边启动 http-server 服务的时候我们使用默认的端口号 8080 。所以我们在 ngrok 中我们绑定 端口 8080 。输入命令 ： ./ngrok http 8080 之后我们看一下。（记得再打开一个终端哦，在另一个终端中进行操作）</p>
<p><img src="/img/osen/20170905_pwa/16.png" alt></p>
<p>我们看到绿色的字母 online 表示内网穿透成功了，我们看最后一个 <em>Forwarding     https://</em> 的，因为我们在上边介绍了，SW 的权利比较大，为了保证信息的安全性，我们使用 https 协议来进行访问。我们把它复制下来在 chrom 浏览器中打开，-&gt; 符号后边的就不用复制了哈。（ <em>每个人的 ‘隧道’ 都是不一样的哦，这一点同学们可以在 ngrok 官网中进行查询哦</em> ）。</p>
<p>我们打开 chrom 的调试工具，打开 application ，点击 service workers 之后我们会发现 sw.js 脚本已经存到了 SW 中 。</p>
<p><img src="/img/osen/20170905_pwa/17.png" alt></p>
<p>我们打开 Network 刷新页面一下，看看，我们的页面资源来自 SW 而不是其他的地方，在 Console 中也打印出了我们在 index.html 中判断的语句，浏览器支持就会打印出这一句话哦。   </p>
<p><img src="/img/osen/20170905_pwa/18.png" alt></p>
<p>接下来我们断网操作，在 <code>Application</code> 中给 <code>Offline</code> 打上对勾就行啦。然后刷新页面，我们仍然能看到之前的页面，原因就是我们在上图看到，他的资源是从 SW 上获得到的。当我们第一次打开这个页面的时候，<code>Resopnse</code> 对象被存到了 <code>Cache Storage</code> （ 定义在 SW 规范中 ，相关资料请同学们自行查询啦 ）中，我们看下图：</p>
<p><img src="/img/osen/20170905_pwa/19.png" alt></p>
<p>通过存放到 <code>Cache Storage</code> 中，我们下次访问的时候如果是弱网或者断网的情况下，就可以不走网络请求，而直接就能将本地缓存的内容展示给用户，优化用户的弱网及断网体验。</p>
<p>这个时候肯定会有同学在想，如果内容更新了，那么页面展示的内容是新内容呢还是旧内容呢？下面我们操作一下，打开 <code>index.html</code> 文件，我们在 <code>body</code> 中添加一个 <code>p</code> 标签 ，然后回到页面刷新。</p>
<p><img src="/img/osen/20170905_pwa/20.png" alt></p>
<p><img src="/img/osen/20170905_pwa/21.png" alt></p>
<p>我们看到，页面上的内容并没有显示出我刚刚添加的那个 <code>p</code> 标签。这说明了，我们拿到的数据还是从 <code>Cache Storage</code> 中获取到的，<code>Cache Storage</code>中的内容并没有更新，那么我们怎么才能让我刚刚添加的那个 <code>p</code> 标签显示出来呢。</p>
<p>我们打开 sw.js 脚本文件，我们修改一下 cacheStorageKey。</p>
<p><img src="/img/osen/20170905_pwa/22.png" alt></p>
<p>我们关闭一下浏览器，然后再次打开该网址，页面出现了我们刚刚添加的那个 <code>p</code> 标签。我们再看一下 <code>Cache Storage</code> 中的缓存名字，已经被修改</p>
<p><img src="/img/osen/20170905_pwa/23.png" alt></p>
<p>【 总结 】</p>
<p>在研究这个 PWA 的过程中，搜索了相关的一大部分知识，就怕自己的脑洞不够大。感觉 PWA 涉及到的 API 比较多。要想研究透彻 PWA 还需要研究它所涉及到的 API ，慢慢研究吧。<code>npm</code> 中已经有这个包了哦。想真实的对 PWA 做深入研究的同学，可以应用到实际项目中。（ 我感觉，会有很多坑 ）</p>

    

    
</div>


                

                <!-- Post Comments -->
                
                    




    <!-- 使用 DISQUS -->
    <div id="disqus-comment">
        <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
        this.page.url = 'http://web.blued.cn/2017/09/05/PWA-Progressiv-Web-App/';  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = 'http://web.blued.cn/2017/09/05/PWA-Progressiv-Web-App/'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    queue.offer(function() {
            (function() { // DON'T EDIT BELOW THIS LINE
                var d = document;
                var s = d.createElement('script');
                s.src = '//bluedweb.disqus.com/embed.js';
                s.setAttribute('data-timestamp', + new Date());
                (d.head || d.body).appendChild(s);
            })();
        });
</script>

    </div>
    <style>
        #disqus-comment{
            background-color: #eee;
            padding: 2pc;
        }
    </style>




                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2017/10/11/fix-hammerjs-conflict/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2017/09/02/十七岁呀十七岁/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
  <!-- Top bar -->
  <div class="top-bar"></div>

  <!-- Sidebar toggle button -->
  <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
    <i class="material-icons">clear_all</i>
    <span class="mdl-button__ripple-container">
      <span class="mdl-ripple"></span>
    </span>
  </button>

  <!-- Sidebar Avatar -->
  <div class="sidebar-image">
    <img src="/img/avatar.png" alt="Blued's avatar">
  </div>

  <!-- Sidebar Email -->
  <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
    web@blued.com
    <b class="caret"></b>
  </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="mailto:web@blued.com" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
                <li>
                    <a href="https://github.com/bluedapp" target="_blank" title="GitHub">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">home</i>
                        
                        GitHub
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/" target="_self">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2019/10/">十月 2019<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/08/">八月 2019<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/04/">四月 2019<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/01/">一月 2019<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/09/">九月 2018<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/05/">五月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/04/">四月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/03/">三月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/12/">十二月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/10/">十月 2017<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/09/">九月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/08/">八月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/07/">七月 2017<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/06/">六月 2017<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/05/">五月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/04/">四月 2017<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    

    <!-- Pages  -->
    

    <!-- Article Number  -->
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->

    <a href="https://github.com/viosey/hexo-theme-material"  class="sidebar-footer-text-a" target="_blank">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
            主题 - Material
            <span class="sidebar-badge badge-circle">i</span>
        </div>
    </a>


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
        <a href="https://twitter.com/blued" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-twitter.svg);">
                <span class="visuallyhidden">Twitter</span>
            </button><!--
     --></a>
    

    <!-- Facebook -->
    
        <a href="https://www.facebook.com/bluedapp" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-facebook.svg);">
                <span class="visuallyhidden">Facebook</span>
            </button><!--
     --></a>
    

    <!-- Google + -->
    

    <!-- Weibo -->
    
        <a href="http://weibo.com/bluedapp" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-weibo.svg);">
                <span class="visuallyhidden">Weibo</span>
            </button><!--
     --></a>
    

    <!-- Instagram -->
    
        <a href="https://instagram.com/bluedapp" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-instagram.svg);">
                <span class="visuallyhidden">Instagram</span>
            </button><!--
     --></a>
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="https://github.com/bluedapp" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-github.svg);">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;
            <script type="text/javascript">
                var fd = new Date();
                document.write(fd.getFullYear());
            </script>
            &nbsp;BluedWeb
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import File -->

    <script src="/js/lazyload.min.js"></script>
    <script src="/js/js.min.js"></script>



    <script src="/js/nprogress.js"></script>


<script type="text/javascript">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>












    <!-- 使用 DISQUS js 代码 -->
    <script id="dsq-count-scr" src="//bluedweb.disqus.com/count.js" async></script>





<!-- Window Load-->
<script>
    $(window).load(function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });
</script>

<!-- MathJax Load-->

<script>
    <!-- Offer LazyLoad -->
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    <!-- Start Queue -->
    $(document).ready(function(){
        setTimeout(function(){
            setInterval(function(){
                queue.execNext();
            },200);
        },3000);
    });
</script>

                </main>
            </div>
        </body>
    
</html>
