<!DOCTYPE html>
<html lang="zh">
    <head><meta name="generator" content="Hexo 3.9.0">
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.3.3 -->

    <!-- Title -->
    
    <title>
        
            十七岁呀十七岁 | 
        
        BluedWeb
    </title>

    <!-- Meta & Info -->
    <meta charset="utf-8">

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">
    
    
    
    
    
    

    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="Blued">
    <meta name="description" content>
    <meta name="keywords" content=",javascript">

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.ico">
    <link rel="icon" sizes="192x192" href="/img/favicon.ico">
    <link rel="apple-touch-icon" href="/img/favicon.ico">

    <!--iOS -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="BluedWeb">

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://web.blued.cn">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="十七岁呀十七岁 | BluedWeb">
    <meta property="og:description" content>
    <meta property="og:article:tag" content="javascript"> 

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import CSS & jQuery -->
    
        <link rel="stylesheet" href="/css/material.min.css">
        <link rel="stylesheet" href="/css/style.min.css">
        <!-- Config CSS -->


<!-- Other Styles -->
<style>
  body, html {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", SimSun, sans-serif;;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

  #post-content pre {
    background: #272822;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->


        <script src="/js/jquery.min.js"></script>
        <script src="/js/queue.js"></script>
    

    <!-- UC Browser Compatible -->
    <script>
        var agent = navigator.userAgent.toLowerCase();
        if(agent.indexOf('ucbrowser')>0) {
            document.write("<link rel=\"stylesheet\" href=\"/css/uc.css\">");
            alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
        }
    </script>

    

    


    <!-- Bing Background -->
    

    <!-- Custom Head -->
    
<link rel="stylesheet" href="/css/prism-okaidia.css" type="text/css"></head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->

    <!-- Left aligned menu below button -->
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#null"><span class="post-toc-number">1.</span> <span class="post-toc-text">文字打字机</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#null"><span class="post-toc-number">2.</span> <span class="post-toc-text">图片上传</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#null"><span class="post-toc-number">3.</span> <span class="post-toc-text">图片预览</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#FileReader"><span class="post-toc-number">4.</span> <span class="post-toc-text">FileReader</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#null"><span class="post-toc-number">5.</span> <span class="post-toc-text">格式转化</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#canvas-直接获得-Blob"><span class="post-toc-number">6.</span> <span class="post-toc-text">canvas 直接获得 Blob</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#base64-转化为-Blob"><span class="post-toc-number">7.</span> <span class="post-toc-text">base64 转化为 Blob</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Blob-转为-file-格式"><span class="post-toc-number">8.</span> <span class="post-toc-text">Blob 转为 file 格式</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#null"><span class="post-toc-number">9.</span> <span class="post-toc-text">截屏处理</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#html2canvas-ele"><span class="post-toc-number">10.</span> <span class="post-toc-text">html2canvas(ele, {})</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#dom-to-image"><span class="post-toc-number">11.</span> <span class="post-toc-text">dom-to-image</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#null"><span class="post-toc-number">12.</span> <span class="post-toc-text"> react-hammer </span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#使用"><span class="post-toc-number">12.1.</span> <span class="post-toc-text">使用</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#六种手势支持"><span class="post-toc-number">12.2.</span> <span class="post-toc-text">六种手势支持</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#事件对象"><span class="post-toc-number">12.3.</span> <span class="post-toc-text">事件对象</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#pan-单手滑动"><span class="post-toc-number">12.4.</span> <span class="post-toc-text">pan 单手滑动</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#拖拽"><span class="post-toc-number">12.5.</span> <span class="post-toc-text">拖拽</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#缩放"><span class="post-toc-number">12.6.</span> <span class="post-toc-text">缩放</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#旋转-rotate"><span class="post-toc-number">12.7.</span> <span class="post-toc-text">旋转 rotate</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#按压-press"><span class="post-toc-number">12.8.</span> <span class="post-toc-text">按压 press</span></a></li></ol></li></ol>

        <!--
        <li class="mdl-menu__item">
            Some Action
        </li>
        -->
    </ul>




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
  <!-- Paradox Post Header -->
  
    
      <!-- Random Thumbnail -->
      <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50" data-original="/img/mxx/20170903_file/file_banner.png">
        <script>
  var randomNum = Math.floor(Math.random() * 19 + 1);

  if (!$('.post_thumbnail-random').attr('data-original')) {
    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.png');
  }
  $('.post_thumbnail-random').addClass('lazy');
</script>

      
      
        <p class="article-headline-p">
          十七岁呀十七岁
        </p>
      </div>
    

    


                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

  <!-- Author Avatar -->
  <div id="author-avatar">
    <img src="https://avatars0.githubusercontent.com/u/3068626?v=4" width="44px" height="44px" alt="Author Avatar"/>
  </div>
  <!-- Author Name & Date -->
  <div>
    <strong>
      <a href="https://github.com/mxx">mxx</a>
    </strong>
    <span>9月 02, 2017</span>
  </div>

  <div class="section-spacer"></div>

  <!-- Favorite -->
  <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

  <!-- Qrcode -->
  
    <button id="article-functions-qrcode-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
      <i class="material-icons" role="presentation">devices other</i>
      <span class="visuallyhidden">devices other</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-qrcode-button">
      <li class="mdl-menu__item">在其它设备中阅读本文章</li>
      <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPYAAAD2CAAAAADAeSUUAAAC0ElEQVR42u3aUU7EMAwFwL3/peEAq22f7S60yfQLQQmZIPGwndfPls8LGxsbGxsbGxsb+5bsV/y8v/++zqd3Pq2W7OR4/WTP2NjY2DuwT/70x+8cw/IDOv65vT1jY2Nj78DuhUeCqR7BJMywsbGxsZMlkiC5auW87MHGxsbG7m2u1+7pgbGxsbGx502l4/FAr/3UK3X+tJeGjY2NfXv2pKHzXx//w3wbGxsb+5bs3nPc6ElKi/wyUB5aJ3vGxsbGXpQ9bx7lJUr1ymZ1ODHqpWFjY2M/lt0b3OZb7zWDqsE2KkWwsbGxH86eNHQmJUfy1ePPfCW3sbGxsR/OrraE8jDrRVd1kHzyVWxsbOwN2Pmgt1pgHB9Egqm2tEZ3TrGxsbEfzk6WnreKEtgE2Rz0YmNjYz+WncfVPJDyFa4aJ2NjY2PvwM4Hur3mfrWV3wu5k/1jY2NjL8qORqTFAMuLnCh44jdPfp3Y2NjYS7OrcZVsNPnMvNQpRCY2Njb2ouyrGvFJgFUPMR88R8eBjY2NvTS7Cu6FyuQoq7+e8lQEGxsb+7HsZHN52EyCJ8f3hg3Y2NjYq7KThb5dYMwHzOXxADY2NvZC7EnDPflh1Y1OkOVSBBsbG3s5djVO8u+aXL7pXfTBxsbG3o191fWaKvLa1tJJcYWNjY29NDtvwc9HvPlhzVtX2NjY2Duw8xHsvOnfbOu3mkrY2NjY+7AL/8oXL/TkDaD8QKsNL2xsbOwd2NUCo1daTBhfGQ9gY2NjL8SuPvPhQe8geitjY2Nj78CulhD5O9UBcHUkXI5DbGxs7KXZvdDqBVI+AJhcFcLGxsbek50EUhXfGy1cFbHY2NjY2L1yotqc6g0V8v1jY2NjYyfx02v39wKsGYTY2NjYG7Dnw93jomUyEp6UTNjY2Ng7sL8x6O1du6keQSEysbGxsRdl7/NgY2NjY2NjY2Nj3+b5Bb1dchS4f0VwAAAAAElFTkSuQmCC">
    </ul>
  

  <!-- Tags (bookmark) -->
  
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
      <i class="material-icons" role="presentation">bookmark</i>
      <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
      <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/javascript/">javascript</a>
    </ul>
  

  <!-- Share -->
  <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    

    <!-- Share Twitter -->
    

    <!-- Share Facebook -->
    

    <!-- Share Google+ -->
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    

    <!-- Share Telegram -->
    
</ul>

</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <h3 style="color: #d7754a">文字打字机</h3>

<p><img src="/img/mxx/20170903_file/word.gif" alt="Typewriter"></p>
<p>打字机原理是开启定时器一个字一个字的将其展示出来</p>
<pre class=" language-javascript"><code class="language-javascript">  <span class="token keyword">let</span> code <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#code'</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> cont <span class="token operator">=</span> code<span class="token punctuation">.</span>innerHTML
  <span class="token keyword">let</span> len <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    code<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> cont<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'_'</span>
    len <span class="token operator">++</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">></span> cont<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">clearInterval</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">)</span>
</code></pre>
<p>当全部的内容都显示出来之后 要将定时器清除掉</p>
<p><a href="http://www.webmxx.com/dest/JSTEST/uploadimg/words.html" target="_blank" rel="noopener">打字机效果demo在线演示</a></p>
<h3 style="color: #d7754a">图片上传</h3>

<p>图片上传可以借助 input 元素 获取图片信息</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>file<span class="token punctuation">'</span></span> <span class="token punctuation">/></span></span>
</code></pre>
<p>通过监听元素的 change 事件 [当选择的元素发生变动] 可以获取上传的文件信息</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">let</span> input <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span>
input<span class="token punctuation">.</span>onchange <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p><img src="/img/mxx/20170903_file/end.png" alt="mobile"></p>
<h3 style="color: #d7754a">图片预览</h3>

<p>当获取到图片文件信息之后 可以进行预览操作</p>
<p>File文件上传之后 在函数中得到的是File格式的内容 如果想要将其以图片格式展现  可以将其转换化为可预览的格式</p>
<h3 id="FileReader"><a href="#FileReader" class="headerlink" title="FileReader"></a>FileReader</h3><p>FileReader 允许Web应用程序异步读取存储在用户计算机上的文件</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">let</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<ul>
<li>readAsDataURL（file)</li>
</ul>
<p>此方法 将图片资源转为数据URL的形式保存在result中</p>
<ul>
<li>window.URL</li>
</ul>
<p>此方法不必把文件内容读取到JavaScript中 而是直接使用文件内容</p>
<p>但是在不同浏览器中 是有兼容性问题的 因此可以使用此函数</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> creatObjUrl <span class="token punctuation">(</span>blob<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>URL<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> window<span class="token punctuation">.</span>URL<span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>webkitURL<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> window<span class="token punctuation">.</span>webkitURL<span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>此时得到的其实是一个 Blob 类型的对象</p>
<p><img src="/img/mxx/20170903_file/blob.png" alt="mobile"></p>
<p>但是需要注意的是 这种方式是占用内存的 所以当使用结束 需要手动进行内存的释放</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> revokeObjectUrl <span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>URL<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span>URL<span class="token punctuation">.</span><span class="token function">revokeObjectURL</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span>webkitURL<span class="token punctuation">.</span><span class="token function">revokeObjectURL</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>或者也可以等待页面关闭自己会进行内存释放</p>
<p>关于图片上传以及预览的<a href="http://www.webmxx.com/dest/JSTEST/uploadimg/upload.html" target="_blank" rel="noopener">demo</a></p>
<h3 style="color: #d7754a">格式转化</h3>

<p>文件格式可以是 base64  Blob  File 这几种 这里的file 指的是 form表单提交的时候的File对象</p>
<h3 id="canvas-直接获得-Blob"><a href="#canvas-直接获得-Blob" class="headerlink" title="canvas 直接获得 Blob"></a>canvas 直接获得 Blob</h3><pre class=" language-javascript"><code class="language-javascript">canvas<span class="token punctuation">.</span><span class="token function">toBlob</span><span class="token punctuation">(</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>canvas.toBlob(callback, type, encoderOptions)</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>callback</td>
<td>回到函数 参数为Blob</td>
</tr>
<tr>
<td>type</td>
<td>图片格式，默认格式为image/png</td>
</tr>
<tr>
<td>encoderOptions</td>
<td>指定图片展示质量 0-1</td>
</tr>
</tbody>
</table>
<blockquote>
<p>创造Blob对象，用以展示canvas上的图片；这个图片文件可以被缓存或保存到本地，由用户代理端自行决定。如不特别指明，图片的类型默认为 image/png，分辨率为96dpi</p>
</blockquote>
<p>浏览器支持情况不好</p>
<p><img src="/img/mxx/20170903_file/mobile.png" alt="mobile"><br><img src="/img/mxx/20170903_file/desktop.png" alt="mobile"></p>
<h3 id="base64-转化为-Blob"><a href="#base64-转化为-Blob" class="headerlink" title="base64 转化为 Blob"></a>base64 转化为 Blob</h3><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">convertBase64UrlToBlob</span><span class="token punctuation">(</span>urlData<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">//去掉url的头，并转换为byte</span>
  <span class="token keyword">var</span> bytes <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">atob</span><span class="token punctuation">(</span>urlData<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>   
  <span class="token comment" spellcheck="true">//处理异常,将ascii码小于0的转换为大于0</span>
  <span class="token keyword">var</span> ab <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
  <span class="token keyword">var</span> ia <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>ab<span class="token punctuation">)</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> bytes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ia<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> bytes<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span> <span class="token punctuation">[</span>ab<span class="token punctuation">]</span> <span class="token punctuation">,</span> <span class="token punctuation">{</span>type <span class="token punctuation">:</span> <span class="token string">'image/png'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="Blob-转为-file-格式"><a href="#Blob-转为-file-格式" class="headerlink" title="Blob 转为 file 格式"></a>Blob 转为 file 格式</h3><p>Blob转为 file格式 是模拟了一个form表单的提交过程</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">let</span> form <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'photo'</span><span class="token punctuation">,</span> imgBlob<span class="token punctuation">)</span>
$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  url<span class="token punctuation">:</span> <span class="token string">'upload'</span><span class="token punctuation">,</span>
  type<span class="token punctuation">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
  data<span class="token punctuation">:</span> formData<span class="token punctuation">,</span>
  processData<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">// 不处理数据</span>
  contentType<span class="token punctuation">:</span> <span class="token boolean">false</span>   <span class="token comment" spellcheck="true">// 不设置内容类型</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h3 style="color: #d7754a">截屏处理</h3>

<p>截屏处理的部分使用了第三方插件  以下两个第三方插件无法在静态页面实现截屏效果</p>
<h3 id="html2canvas-ele"><a href="#html2canvas-ele" class="headerlink" title="html2canvas(ele, {})"></a>html2canvas(ele, {})</h3><p><a href="https://github.com/niklasvh/html2canvas" target="_blank" rel="noopener">Github</a></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>ele</td>
<td>裁剪区域目标元素</td>
</tr>
<tr>
<td>onrendered</td>
<td>回调函数 参数是截取图片之后的canvas对象</td>
</tr>
<tr>
<td>useCORS</td>
<td>图片跨域</td>
</tr>
<tr>
<td>width</td>
<td>想要截取的 canvas 图片宽度</td>
</tr>
<tr>
<td>height</td>
<td>想要截取的 canvas 图片高度</td>
</tr>
</tbody>
</table>
<pre class=" language-javascript"><code class="language-javascript"><span class="token function">html2canvas</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'view'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  onrendered<span class="token punctuation">:</span> <span class="token punctuation">(</span>canvas<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    image <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token string">'image/png'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>这函数中的参数 是一个canvas对象  所以可以借助canvas提供的方法将其转化为可以被预览的图片格式</p>
<pre class=" language-javascript"><code class="language-javascript">canvas<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token string">'image/png'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">// 或者</span>
canvas<span class="token punctuation">.</span><span class="token function">toBlob</span><span class="token punctuation">(</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p><strong>  此处有坑  canvas.toBlob 无法在iOS中实现  </strong></p>
<ul>
<li>图片跨域</li>
</ul>
<p>如果截屏区域的图片涉及到跨域问题  则会发现截屏之后 没有该图片</p>
<p>使用一张不同域名的盛世美颜来测试关于图片跨域的问题 当点击截屏按钮会发现并没有将此图片截取到</p>
<p><img src="/img/mxx/20170903_file/clip.gif" alt="clip"></p>
<p>因此添加一个属性 useCORS 可以用来处理此问题</p>
<pre class=" language-javascript"><code class="language-javascript">useCORS<span class="token punctuation">:</span> <span class="token boolean">true</span>
</code></pre>
<p><img src="/img/mxx/20170903_file/clip2.gif" alt="clip"></p>
<ul>
<li>使用html2canvas 发生截屏图片模糊问题</li>
</ul>
<p>使用html2canvas 会发现截屏图片模糊 这是由于像素点的渲染图片的问题</p>
<p>浏览器window中的devicePixelRatio属性决定了浏览器会用几个像素点来渲染一个像素</p>
<p>假设devicePixelRatio=2，在retina屏下，<strong> 会用2个像素点的宽度去渲染canvas的1个像素点 </strong> ，该canvas在retina屏幕上实际占据的宽高放大了一倍，因此图片会变得模糊</p>
<p>解决原理: 放大canvas的坐标系，然后缩小其显示的宽高</p>
<p><a href="https://github.com/omwteam/html2canvas" target="_blank" rel="noopener">处理方案</a></p>
<h3 id="dom-to-image"><a href="#dom-to-image" class="headerlink" title="dom-to-image"></a>dom-to-image</h3><p><a href="https://github.com/tsayen/dom-to-image" target="_blank" rel="noopener">Github</a></p>
<pre class=" language-javascript"><code class="language-javascript">domtoimage<span class="token punctuation">.</span><span class="token function">toPng</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'view'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>dataUrl<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dataUrl<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>dom-to-image 支持 promise 方式使用 非常简单 而且提供了很多功能</p>
<p>此方式返回值 dataUrl 是一个base64格式的字符串 可以直接放入图片的src属性 进行图片预览</p>
<p><strong>  然而有坑  Safari is not supported  </strong></p>
<ul>
<li>图片下载</li>
</ul>
<p>借助第三方插件 FileSaver 实现</p>
<p><a href="https://github.com/eligrey/FileSaver.js" target="_blank" rel="noopener">FileSaver</a></p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">let</span> FileSaver <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'file-saver'</span><span class="token punctuation">)</span>

domtoimage<span class="token punctuation">.</span><span class="token function">toBlob</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'view'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>blob<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      FileSaver<span class="token punctuation">.</span><span class="token function">saveAs</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span> <span class="token string">'my-node.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>其实实现图片下载也可以通过模拟 a 标签的点击</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">let</span> link <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
link<span class="token punctuation">.</span>download <span class="token operator">=</span> <span class="token string">'image-name.jpeg'</span>
link<span class="token punctuation">.</span>href <span class="token operator">=</span> dataUrl
link<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p><strong>  但是在这种方式是移动端不可以的  </strong></p>
<p><a href="https://github.com/mengxxSELF/clipScreen" target="_blank" rel="noopener">关于实现截屏效果以及下载的demo</a></p>
<h3 style="color: #d7754a"> react-hammer </h3>

<p>react-hammer是一个帮助实现移动端拖拽效果的插件</p>
<p><a href="https://www.npmjs.com/package/react-hammerjs" target="_blank" rel="noopener">npm</a></p>
<p><a href="https://github.com/JedWatson/react-hammerjs" target="_blank" rel="noopener">Github</a></p>
<p>其实React-hammer是基于<a href="http://hammerjs.github.io/" target="_blank" rel="noopener">hammer.js</a> 构建而成的一个更适合在React中使用的触摸插件</p>
<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><pre class=" language-html"><code class="language-html">let Hammer = require('react-hammerjs')

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Hammer</span> <span class="token attr-name">onTap</span><span class="token attr-value"><span class="token punctuation">=</span>{handleTap}</span> <span class="token attr-name">options</span><span class="token attr-value"><span class="token punctuation">=</span>{options}</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>Tap Me<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Hammer</span><span class="token punctuation">></span></span>

</code></pre>
<h4 id="六种手势支持"><a href="#六种手势支持" class="headerlink" title="六种手势支持"></a>六种手势支持</h4><p>react-hammer.js 支持六种手势操作</p>
<table>
<thead>
<tr>
<th>事件</th>
<th>手势</th>
</tr>
</thead>
<tbody>
<tr>
<td>pan</td>
<td>单手指滑动</td>
</tr>
<tr>
<td>tap</td>
<td>单手指点触</td>
</tr>
<tr>
<td>doubleTap</td>
<td>单手指双击</td>
</tr>
<tr>
<td>pinch</td>
<td>两个手指进行缩放动作</td>
</tr>
<tr>
<td>press</td>
<td>单手指下压</td>
</tr>
<tr>
<td>rotate</td>
<td>双手指旋转</td>
</tr>
<tr>
<td>swipe</td>
<td>单手指滑动</td>
</tr>
</tbody>
</table>
<p>默认状态下 是无法进行pinch 与 rotate 操作的 需要手动将其设置为TRUE</p>
<blockquote>
<p>As a default, the pinch and rotate events are disabled in hammer.js, as they would make actions on an element “blocking”.</p>
</blockquote>
<pre class=" language-html"><code class="language-html">let options = {
  recognizers: {
    pinch: { enable: true },
    rotate: { enable: true }
  }
}

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Hammer</span> <span class="token attr-name">options</span><span class="token attr-value"><span class="token punctuation">=</span>{options}</span> <span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>{text}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Hammer</span><span class="token punctuation">></span></span>
</code></pre>
<p>这样才能进行缩放以及旋转动作</p>
<h4 id="事件对象"><a href="#事件对象" class="headerlink" title="事件对象"></a>事件对象</h4><p>每一个事件的回调函数中都有一个事件对象 包含以下属性 (展示部分常用属性)</p>
<table>
<thead>
<tr>
<th>事件对象</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>type</td>
<td>事件类型</td>
</tr>
<tr>
<td>deltaX</td>
<td>X轴方向移动</td>
</tr>
<tr>
<td>deltaY</td>
<td>Y轴方向移动</td>
</tr>
<tr>
<td>distance</td>
<td>移动距离</td>
</tr>
<tr>
<td>direction</td>
<td>移动的方向</td>
</tr>
<tr>
<td>srcEvent</td>
<td>事件来源</td>
</tr>
<tr>
<td>rotation</td>
<td>多点触摸时已经完成的旋转（deg）</td>
</tr>
<tr>
<td>eventType</td>
<td>事件类型，匹配INPUT常量</td>
</tr>
</tbody>
</table>
<h4 id="pan-单手滑动"><a href="#pan-单手滑动" class="headerlink" title="pan 单手滑动"></a>pan 单手滑动</h4><table>
<thead>
<tr>
<th>事件</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>pan</td>
<td>单手指滑动 整个滑动周期</td>
</tr>
<tr>
<td>panstart</td>
<td>开始滑动</td>
</tr>
<tr>
<td>panmove</td>
<td>滑动</td>
</tr>
<tr>
<td>panend</td>
<td>滑动结束</td>
</tr>
<tr>
<td>pancancel</td>
<td>滑动取消</td>
</tr>
</tbody>
</table>
<p>默认只能进行水平方向的滑动  <strong> 无法处理垂直方向的滑动  </strong>    因此需要手动添加属性  direction</p>
<p>npm 中这样说道</p>
<blockquote>
<p>If you provide the prop direction the pan and swipe events will support Hammer.DIRECTION_(NONE/LEFT/RIGHT/UP/DOWN/HORIZONTAL/VERTICAL/ALL).</p>
</blockquote>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Hammer</span> <span class="token attr-name">direction</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>DIRECTION_ALL<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>
 ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Hammer</span><span class="token punctuation">></span></span>
</code></pre>
<p><strong> 关于 pancancel </strong></p>
<p>个人感觉应该是在快速拖动导致手势丢失的时候 会触发此事件发生 然而测试中并没有发现有什么用 因为一直会被 panend 被捕捉而不是 pancancel</p>
<h4 id="拖拽"><a href="#拖拽" class="headerlink" title="拖拽"></a>拖拽</h4><p>此函数会一直被执行 从整个滑动开始 正在滑动 滑动结束  </p>
<p>元素跟随手指滑动变动位置的原理是 获取元素初始位置 + 手指滑动距离 然后在手指抬起瞬间 更新元素初始位置</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">let</span> eleLeft <span class="token operator">=</span> startX <span class="token operator">+</span> deltaX
</code></pre>
<p><strong>  结束手指滑动时候 更新元素位置 </strong></p>
<p>之前一直是在 Panend 中处理这个问题 但是发现实际页面拿到的left数据  一旦发生一次滑动结束 再次滑动的时候  里面的值就是undefined  </p>
<p>调试很久之后 将事件处理到 pan 事件中</p>
<p>通过监听事件对象的 eventType === 4 来判断词此时是要结束滑动 然后更新元素初始位置</p>
<p><strong>  有一个坑  </strong></p>
<p>当手指离开屏幕 也就是结束滑动的时候    </p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// 不触发方向运动 也就是手指离开的时候</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>direction <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  end <span class="token operator">=</span> translateX
  topEnd <span class="token operator">=</span> translateY
<span class="token punctuation">}</span>
</code></pre>
<p>不属于任何一个判断条件  但是此时也要处理 左 上 的值  否则也会发现下次出现undefined</p>
<p><strong> 建议不要使用定位变动元素位置 </strong></p>
<p>最开始通过position将元素进行定位 在滑动过程中更改left top 坐标点  但是这种处理方式中 元素滑动并不流畅 体验性很差</p>
<p>可以通过transform来移动元素</p>
<pre class=" language-javascript"><code class="language-javascript">transform<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`translateX(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>translateX<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px) translateY(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>translateY<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)`</span></span><span class="token punctuation">,</span>
</code></pre>
<h4 id="缩放"><a href="#缩放" class="headerlink" title="缩放"></a>缩放</h4><table>
<thead>
<tr>
<th>事件</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>pinch</td>
<td>两个手指缩放 整个缩放周期</td>
</tr>
<tr>
<td>pinchstart</td>
<td>开始滑动</td>
</tr>
<tr>
<td>pinchIn</td>
<td>缩小</td>
</tr>
<tr>
<td>pinchOut</td>
<td>放大</td>
</tr>
<tr>
<td>PinchEnd</td>
<td>缩放取消</td>
</tr>
<tr>
<td>PinchCancel</td>
<td>滑动取消</td>
</tr>
</tbody>
</table>
<p>缩放监听的是两个手指捏合的动作</p>
<p>元素缩小</p>
<pre class=" language-javascript"><code class="language-javascript">pinchIn <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> width <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>width <span class="token operator">-</span> <span class="token number">1</span>
  <span class="token keyword">let</span> height <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>height <span class="token operator">-</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre>
<p>元素放大</p>
<pre class=" language-javascript"><code class="language-javascript">pinchOut <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> width <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>width <span class="token operator">+</span> <span class="token number">1</span>
  <span class="token keyword">let</span> height <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>height <span class="token operator">+</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre>
<p>由于手指捏合速度很快 所以这里直接将元素进行宽度与长度的增减</p>
<p><strong> 最好不要将元素大小变化的处理放入 onPinch 事件 防止手势丢失导致元素一直放大或者缩小 </strong></p>
<h4 id="旋转-rotate"><a href="#旋转-rotate" class="headerlink" title="旋转 rotate"></a>旋转 rotate</h4><p>hammer.js官网中提供的 <a href="http://hammerjs.github.io/#try-it" target="_blank" rel="noopener">旋转案例</a> 中  通过判断两个手指之间的角度差 来更改元素旋转角</p>
<pre class=" language-javascript"><code class="language-javascript">onRotate <span class="token punctuation">(</span>ev<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  transform<span class="token punctuation">.</span>angle <span class="token operator">=</span> initAngle <span class="token operator">+</span> ev<span class="token punctuation">.</span>rotation
<span class="token punctuation">}</span>
</code></pre>
<p>但是这样是有一个问题如果最开始两个手指之间不在同一个水平线上 同样检测到两个手指之间的差值 元素会马上发生转动</p>
<p>所以这个属性不能准确读取到手指旋转角度</p>
<p>测试中发现 函数中事件对象 ev 有一个 srcEvent 参数  它也是一个对象 里面也有一个 rotation 属性 这个真正的表示了每一次手指旋转的角度值</p>
<p><strong> 此处有坑 只在iOS中有此属性 </strong></p>
<p>所以更改为使用此属性值来进行元素的旋转效果</p>
<pre class=" language-javascript"><code class="language-javascript">handleRotate <span class="token punctuation">(</span>ev<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token punctuation">{</span>startRotate<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
  <span class="token keyword">let</span> <span class="token punctuation">{</span>deltaTime<span class="token punctuation">,</span> srcEvent<span class="token punctuation">}</span> <span class="token operator">=</span> ev
  <span class="token comment" spellcheck="true">// 点触事件  时间太短不去触发旋事件</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>deltaTime <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">return</span>

  <span class="token keyword">let</span> <span class="token punctuation">{</span>rotation <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">}</span> <span class="token operator">=</span> srcEvent <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment" spellcheck="true">// 每次手指旋转的角度</span>
  <span class="token keyword">let</span> end
  <span class="token keyword">if</span> <span class="token punctuation">(</span>rotation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 如果存在则表示是在iOS中 rotation 从srcEvent 中获取 表示每一次旋转的角度</span>
    end <span class="token operator">=</span> startRotate <span class="token operator">+</span> rotation
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="按压-press"><a href="#按压-press" class="headerlink" title="按压 press"></a>按压 press</h4><table>
<thead>
<tr>
<th>事件</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>press</td>
<td>按压周期</td>
</tr>
<tr>
<td>pressUp</td>
<td>按压结束 手指抬起</td>
</tr>
</tbody>
</table>
<ul>
<li>旋转的补充方案</li>
</ul>
<p>由于在安卓机中没有拿到每一次旋转角度 因此使用plan B 通过添加两个按钮 当点击按钮或者长按按钮 可以进行图片的旋转</p>
<p>按压过程 通过开启定时器 来不断旋转目标元素</p>
<pre class=" language-javascript"><code class="language-javascript">timer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  old<span class="token operator">--</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>rotateArg<span class="token punctuation">:</span> old<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span>
</code></pre>
<p>在按压结束的时候 清除定期器</p>
<pre class=" language-javascript"><code class="language-javascript">handlePressUp <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  timer <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">clearInterval</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong> bug 处理  手势并发 导致不停旋转 </strong></p>
<p>后来发现 如果在点击旋转按钮的时候 同时触发了别的手势 比如滑动 那么一旦手指离开屏幕 会发现元素会一直转个不停</p>
<p>这是因为定时器的清除操作只写在了 PressUp 这个手势中 而多手势的时候 有时候会读不到此事件</p>
<p>修正措施： 在每一种手势结束的时候 都清除一次定时器 比如 tapEnd 、 pinchEnd等</p>

    

    
</div>


                

                <!-- Post Comments -->
                
                    




    <!-- 使用 DISQUS -->
    <div id="disqus-comment">
        <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
        this.page.url = 'http://web.blued.cn/2017/09/02/十七岁呀十七岁/';  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = 'http://web.blued.cn/2017/09/02/十七岁呀十七岁/'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    queue.offer(function() {
            (function() { // DON'T EDIT BELOW THIS LINE
                var d = document;
                var s = d.createElement('script');
                s.src = '//bluedweb.disqus.com/embed.js';
                s.setAttribute('data-timestamp', + new Date());
                (d.head || d.body).appendChild(s);
            })();
        });
</script>

    </div>
    <style>
        #disqus-comment{
            background-color: #eee;
            padding: 2pc;
        }
    </style>




                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2017/09/05/PWA-Progressiv-Web-App/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2017/08/17/记一个node实现的图形验证码从0到1/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
  <!-- Top bar -->
  <div class="top-bar"></div>

  <!-- Sidebar toggle button -->
  <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
    <i class="material-icons">clear_all</i>
    <span class="mdl-button__ripple-container">
      <span class="mdl-ripple"></span>
    </span>
  </button>

  <!-- Sidebar Avatar -->
  <div class="sidebar-image">
    <img src="/img/avatar.png" alt="Blued's avatar">
  </div>

  <!-- Sidebar Email -->
  <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
    web@blued.com
    <b class="caret"></b>
  </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="mailto:web@blued.com" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
                <li>
                    <a href="https://github.com/bluedapp" target="_blank" title="GitHub">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">home</i>
                        
                        GitHub
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/" target="_self">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2019/10/">十月 2019<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/08/">八月 2019<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/04/">四月 2019<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/01/">一月 2019<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/09/">九月 2018<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/05/">五月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/04/">四月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/03/">三月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/12/">十二月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/10/">十月 2017<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/09/">九月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/08/">八月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/07/">七月 2017<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/06/">六月 2017<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/05/">五月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/04/">四月 2017<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    

    <!-- Pages  -->
    

    <!-- Article Number  -->
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->

    <a href="https://github.com/viosey/hexo-theme-material"  class="sidebar-footer-text-a" target="_blank">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
            主题 - Material
            <span class="sidebar-badge badge-circle">i</span>
        </div>
    </a>


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
        <a href="https://twitter.com/blued" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-twitter.svg);">
                <span class="visuallyhidden">Twitter</span>
            </button><!--
     --></a>
    

    <!-- Facebook -->
    
        <a href="https://www.facebook.com/bluedapp" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-facebook.svg);">
                <span class="visuallyhidden">Facebook</span>
            </button><!--
     --></a>
    

    <!-- Google + -->
    

    <!-- Weibo -->
    
        <a href="http://weibo.com/bluedapp" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-weibo.svg);">
                <span class="visuallyhidden">Weibo</span>
            </button><!--
     --></a>
    

    <!-- Instagram -->
    
        <a href="https://instagram.com/bluedapp" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-instagram.svg);">
                <span class="visuallyhidden">Instagram</span>
            </button><!--
     --></a>
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="https://github.com/bluedapp" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-github.svg);">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;
            <script type="text/javascript">
                var fd = new Date();
                document.write(fd.getFullYear());
            </script>
            &nbsp;BluedWeb
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import File -->

    <script src="/js/lazyload.min.js"></script>
    <script src="/js/js.min.js"></script>



    <script src="/js/nprogress.js"></script>


<script type="text/javascript">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>












    <!-- 使用 DISQUS js 代码 -->
    <script id="dsq-count-scr" src="//bluedweb.disqus.com/count.js" async></script>





<!-- Window Load-->
<script>
    $(window).load(function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });
</script>

<!-- MathJax Load-->

<script>
    <!-- Offer LazyLoad -->
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    <!-- Start Queue -->
    $(document).ready(function(){
        setTimeout(function(){
            setInterval(function(){
                queue.execNext();
            },200);
        },3000);
    });
</script>

                </main>
            </div>
        </body>
    
</html>
